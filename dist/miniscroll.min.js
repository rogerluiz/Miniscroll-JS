/*!
 * Miniscroll small plugin of scrollbar desktop and mobile
 *
 * @author Roger Luiz <http://rogerluizm.com.br/>
 *					  <http://miniscroll.rogerluizm.com.br>
 *
 * @copyright (c) 2011, 2012 <http://rogerluizm.com.br/>
 *
 * @version 1.2.9
 *		update 1.2.9 | 10/09/2013 - fix multidimensional scrollwheel
 *		update 1.2.9 | 10/09/2013 - fix error in the scroll when the position is relative or absolute
 *		update 1.2.9 | 10/09/2013 - fix updating on the x axis
 *		update 1.2.8 | 03/09/2013 - add turn off mousewheel, ex: { mousewheel: true }
 *		update 1.2.7 | 03/09/2013 - add scrollTo, now its posible scroll to a custom position
 *		update 1.2.6 | 21/06/2013 - fix bug the whole scrollbar (not just the handler part) moves down when I drag it.
 *		update 1.2.5 | 18/05/2013 - fix bug thumb position with arrow keys
 * 		update 1.2.4 | 18/05/2013 - fix error it's time to catching the width and height
 * 		update 1.2.3 | 18/05/2013 - fix scrollbar position "x"
 * 		update 1.2.2 | 17/05/2013 - Key event added, now you can press the key down and key up for scrolling
 * 		update 1.2.1 | 15/05/2013 - Touch event added, now works for ipad, iphone and android
 */
!function(t,s,i){var e={touchEvents:"ontouchstart"in s.documentElement},h=function(t,s){this.type="",this.is="static",this.target=this.getElement(t),this.container,this.tracker,this.thumb,this.thumb_delta=o(0,0),this.thumb_pos=o(0,0),this.touch=o(0,0),this.settings=s,this.percent,this.keypos_thumb=o(0,0),this.scrolling=!1,this.preventScrolling=!1,this.turnOffWheel=!0,this.initializing()},o=function(t,s){return this instanceof o?(this.x=t?t:0,this.y=s?s:0,this):new o(t,s)};h[i].initializing=function(){this.buildScrollbar(),this.buildScrollbarTracker(),this.buildScrolbarThumb(),this.settings.isKeyEvent="undefined"==typeof this.settings.isKeyEvent?!0:this.settings.isKeyEvent,this.turnOffWheel="undefined"==typeof this.settings.turnOffWheel?this.turnOffWheel:this.settings.turnOffWheel,this.settings.isKeyEvent&&this.addKeyBoardEvent(),e.touchEvents?this.setupTouchEvent():this.setupEventHandler();var s=this;t.setInterval(function(){s.update()},10)},h[i].buildScrollbar=function(){var t=this.target.id?this.target.id:this.target.className;this.container=this.create(this.target,"div",{"class":"miniscroll-container",id:"miniscroll-"+t});var s=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).height,i=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).width,e=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size),h=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{position:"absolute",visibility:"hidden",width:("x"===this.settings.axis?i:this.settings.size)+"px",height:("y"===this.settings.axis?s:this.settings.size)+"px",top:("y"===this.settings.axis?this.offset(this.target).top:h)+"px",left:("x"===this.settings.axis?this.offset(this.target).left:e)+"px",zIndex:999})},h[i].buildScrollbarTracker=function(){this.tracker=this.create(this.container,"div",{"class":"miniscroll-tracker"});var t="x"===this.settings.axis?this.offset(this.container).width:this.settings.size,s="y"===this.settings.axis?this.offset(this.container).height:this.settings.size;this.css(this.tracker,{width:t+"px",height:s+"px",backgroundColor:this.settings.trackerColor?this.settings.trackerColor:"#067f41"})},h[i].buildScrolbarThumb=function(){this.thumb=this.create(this.container,"div",{"class":"miniscroll-thumb"});var t=o(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight),t=o(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight),s=o(void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?t.x:this.settings.sizethumb,void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?t.y:this.settings.sizethumb);this.css(this.thumb,{position:"absolute",top:"0px",left:"0px",width:("x"===this.settings.axis?s.x:this.settings.size)+"px",height:("y"===this.settings.axis?s.y:this.settings.size)+"px",backgroundColor:this.settings.thumbColor?this.settings.thumbColor:"#2AD47D"})},h[i].setupEventHandler=function(){this.bind(this.thumb,"mousedown",this.onScrollThumbPress),this.bind(this.tracker,"mousedown",this.onScrollTrackerPress),this.turnOffWheel&&this.bind(this.target,"mousewheel",this.onScrollThumbWheel)},h[i].setupTouchEvent=function(){this.bind(this.target,"touchstart",this.onScrollTouchStart),this.bind(this.target,"touchmove",this.onScrollTouchMove)},h[i].updateContainerPosition=function(){this.is=this.getCss(this.target,"position"),"relative"===this.is||"absolute"===this.is?"y"===this.settings.axis?(this.container.style.top=this.target.scrollTop+"px",this.container.style.left=this.offset(this.target).width-this.settings.size+"px"):(this.container.style.top=this.offset(this.target).height-this.settings.size+"px",this.container.style.left=this.target.scrollLeft+"px"):"y"===this.settings.axis?this.container.style.top=this.offset(this.target).top+"px":this.container.style.left=this.offset(this.target).left+"px"},h[i].setScrubPosition=function(t){var s=this.offset(this.container).width,i=this.offset(this.container).height,e=this.offset(this.thumb).width,h=this.offset(this.thumb).height;this.thumb_pos=o(Math.round((s-e)*t),Math.round((i-h)*t)),"y"===this.settings.axis?this.thumb.style.top=Math.round(this.thumb_pos.y)+"px":this.thumb.style.left=Math.round(this.thumb_pos.x)+"px"},h[i].addKeyBoardEvent=function(){this.target.setAttribute("tabindex","-1"),this.css(this.target,{outline:"none"}),this.bind(this.target,"focus",function(t,i){!("onkeydown"in i)&&"onkeydown"in s&&(i=s),this.bind(i,"keydown",function(t){if(t.target==this.target){var s,i=t.keyCode||t.which,e={left:37,up:38,right:39,down:40},h=!0;switch(i){case e.up:0!==this.percent&&(this.keypos_thumb.y-=10);break;case e.down:1!==this.percent&&(this.keypos_thumb.y+=10);break;case e.left:0!==this.percent&&(this.keypos_thumb.x-=10);break;case e.right:1!==this.percent&&(this.keypos_thumb.x+=10);break;default:h=!1}"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.setScrubPosition(this.percent),this.target.scrollTop=this.keypos_thumb.y,s=[38,40]):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.setScrubPosition(this.percent),this.target.scrollLeft=this.keypos_thumb.x,s=[37,39]),this.preventScrolling=this.percent>=1&&i==s[1]||this.percent<=0&&i==s[0]?!0:!1,!this.preventScrolling&&h&&this.stopEvent(t),this.updateContainerPosition()}})}),this.bind(this.target,"click",function(t,i){if(t.target==this.target){try{s.activeElement=i}catch(e){}i.focus()}})},h[i].onScrollTouchStart=function(t){var s=t.touches[0];this.scrolling=!0,this.touch=o(s.pageX,s.pageY),this.bind(this.target,"touchend",this.onScrollTouchEnd)},h[i].onScrollTouchMove=function(t){var s=t.touches[0];t.preventDefault();var i=o(this.touch.x-s.pageX,this.touch.y-s.pageY);this.touch=o(s.pageX,s.pageY),"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.setScrubPosition(this.percent),this.target.scrollTop=this.target.scrollTop+i.y):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.setScrubPosition(this.percent),this.target.scrollLeft=this.target.scrollLeft+i.x),this.updateContainerPosition()},h[i].onScrollTouchEnd=function(){this.scrolling=!1,this.unbind(this.target,"touchend",this.onScrollTouchEnd)},h[i].onScrollThumbPress=function(i){i=i?i:t.event,this.stopEvent(i),this.scrolling=!0,this.thumb_delta=o(this.thumb_pos.x-this.mouse(i).x,this.thumb_pos.y-this.mouse(i).y),this.bind(s,"mousemove",this.onScrollThumbUpdate),this.bind(s,"mouseup",this.onScrollThumbRelease),this.updateContainerPosition()},h[i].onScrollThumbUpdate=function(s){return s=s?s:t.event,this.stopEvent(s),this.scrolling?(this.thumb_pos=o(this.mouse(s).x+this.thumb_delta.x,this.mouse(s).y+this.thumb_delta.y),this.thumb_pos=o(Math.max(0,Math.min(this.container.offsetWidth-this.thumb.offsetWidth,this.thumb_pos.x)),Math.max(0,Math.min(this.container.offsetHeight-this.thumb.offsetHeight,this.thumb_pos.y))),this.percent=o(this.thumb_pos.x/(this.container.offsetWidth-this.thumb.offsetWidth),this.thumb_pos.y/(this.container.offsetHeight-this.thumb.offsetHeight)),this.percent=o(Math.max(0,Math.min(1,this.percent.x)),Math.max(0,Math.min(1,this.percent.y))),"y"===this.settings.axis?(this.thumb.style.top=Math.round(this.thumb_pos.y)+"px",this.target.scrollTop=Math.round((this.target.scrollHeight-this.target.offsetHeight)*this.percent.y)):(this.thumb.style.left=Math.round(this.thumb_pos.x)+"px",this.target.scrollLeft=Math.round((this.target.scrollWidth-this.target.offsetWidth)*this.percent.x)),this.keypos_thumb=o(this.target.scrollLeft,this.target.scrollTop),void this.updateContainerPosition()):!1},h[i].onScrollThumbWheel=function(s){s=s?s:t.event;var i,e=s||t.event,h=([].slice.call(arguments,1),0),n=0,r=0;e.wheelDelta&&(h=e.wheelDelta/120),e.detail&&(h=-e.detail/3),r=h,n=h,e.deltaMode&&(r=-e.deltaY/3,n=-e.deltaX/3),void 0!==e.axis&&e.axis===e.HORIZONTAL_AXIS&&(r=0,n=-1*h),void 0!==e.wheelDeltaY&&(r=e.wheelDeltaY/120),void 0!==e.wheelDeltaX&&(n=-1*e.wheelDeltaX/120),"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.setScrubPosition(this.percent),this.target.scrollTop=Math.round(this.target.scrollTop-10*r),i=r):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.setScrubPosition(this.percent),this.target.scrollLeft=Math.round(this.target.scrollLeft-10*n),i=n),this.preventScrolling=this.percent>=1&&0>i||this.percent<=0&&i>0||0==i?!0:!1,this.preventScrolling||this.stopEvent(s),this.keypos_thumb=o(this.target.scrollLeft,this.target.scrollTop),this.updateContainerPosition()},h[i].onScrollThumbRelease=function(i){i=i?i:t.event,this.stopEvent(i),this.scrolling=!1,this.unbind(s,"mousemove",this.onScrollThumbUpdate),this.unbind(s,"mouseup",this.onScrollThumbRelease)},h[i].onScrollTrackerPress=function(t){var s=this.mouse(t).y-this.offset(this.container).top;this.scrolling=!0,this.scrollTo(s)},h[i].scrollTo=function(t){var s=Math.max(0,Math.min(this.offset(this.target).height-this.offset(this.thumb).height,t));"y"===this.settings.axis&&(this.thumb_pos.y=s,this.thumb.style.top=Math.round(this.thumb_pos.y)+"px",this.target.scrollTop=s,this.scrolling=!1)},h[i].update=function(){"y"===this.settings.axis?this.target.scrollHeight===this.offset(this.target).height?this.css(this.container,{visibility:"hidden"}):this.css(this.container,{visibility:"visible"}):this.target.scrollWidth===this.offset(this.target).width?this.css(this.container,{visibility:"hidden"}):this.css(this.container,{visibility:"visible"});var t=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).height,s=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).width,i=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size),e=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{width:("x"===this.settings.axis?s:this.settings.size)+"px",height:("y"===this.settings.axis?t:this.settings.size)+"px",top:("y"===this.settings.axis?this.offset(this.target).top:e)+"px",left:("x"===this.settings.axis?this.offset(this.target).left:i)+"px"});var h="x"===this.settings.axis?this.offset(this.container).width:this.settings.size,n="y"===this.settings.axis?this.offset(this.container).height:this.settings.size;this.css(this.tracker,{width:h+"px",height:n+"px"});var r=o(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight),a=o(void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?r.x:this.settings.sizethumb,void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?r.y:this.settings.sizethumb);this.css(this.thumb,{width:("x"===this.settings.axis?a.x:this.settings.size)+"px",height:("y"===this.settings.axis?a.y:this.settings.size)+"px"}),"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.scrolling||this.setScrubPosition(this.percent)):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.scrolling||this.setScrubPosition(this.percent)),this.updateContainerPosition()},h[i].getElement=function(i){var e;if(i===t||i===s||"body"===i||"body, html"===i)return s.body;if("string"==typeof i||i instanceof String){var e,h=i.replace(/^\s+/,"").replace(/\s+$/,"");if(h.indexOf("#")>-1){this.type="id";var o=h.split("#");e=s.getElementById(o[1])}if(h.indexOf(".")>-1){this.type="class";for(var o=h.split("."),n=s.getElementsByTagName("*"),r=n.length,a=0;r>a;a++)n[a].className&&n[a].className.match(new RegExp("(^|\\s)"+o[1]+"(\\s|$)"))&&(e=n[a])}return e}return i},h[i].create=function(t,i,e){var h=s.createElement(i);if(e){for(var o in e)e.hasOwnProperty(o)&&h.setAttribute(o,e[o]);t.appendChild(h)}return h},h[i].css=function(t,s){for(var i in s)"opacity"===i?(t.style.filter="alpha(opacity="+100*s[i]+")",t.style.KhtmlOpacity=s[i],t.style.MozOpacity=s[i],t.style.opacity=s[i]):t.style[i]=s[i]},h[i].getCss=function(i,e){var h;return h=t.getComputedStyle?t.getComputedStyle(i).getPropertyValue(e):s.defaultView&&s.defaultView.getComputedStyle?s.defaultView.getComputedStyle.getPropertyValue(e):i.currentStyle?i.currentStyle[e]:i.style[e]},h[i].offset=function(t){var s=t.offsetTop,i=t.offsetLeft,e=t.offsetHeight;"undefined"==typeof t.offsetHeight&&(e=parseInt(this.getCss(t,"height")));var h=t.offsetWidth;return"undefined"==typeof t.offsetWidth&&(h=parseInt(this.getCss(t,"width"))),{top:s,left:i,width:h,height:e}},h[i].mouse=function(t){var i=0,e=0;return t.pageX||t.pageY?(i=t.pageX,e=t.pageY):(t.clientX||t.clientY)&&(i=t.clientX+s.body.scrollLeft+s.documentElement.scrollLeft,e=t.clientY+s.body.scrollTop+s.documentElement.scrollTop),{x:i,y:e}},h[i].bind=function(t,i,e){var h="onwheel"in s.createElement("div")?"wheel":void 0!==s.onmousewheel?"mousewheel":"DOMMouseScroll",o=this;t.addEventListener?"mousewheel"===i?t.addEventListener(h,function(t){e.call(o,t,this)},!1):t.addEventListener(i,function(t){e.call(o,t,this)},!1):t.attachEvent?t.attachEvent("on"+i,function(t){e.call(o,t,this)}):t["on"+i]=function(t){e.call(o,t,this)}},h[i].unbind=function(t,i,e){var h="onwheel"in s.createElement("div")?"wheel":void 0!==s.onmousewheel?"mousewheel":"DOMMouseScroll";t.addEventListener?"mousewheel"===i?t.removeEventListener(h,function(t){e.call(_this,t,this)},!1):t.removeEventListener(i,function(t){e.call(_this,t,this)},!1):t.attachEvent?t.detachEvent("on"+i,function(t){e.call(_this,t,this)}):t["on"+i]=null},h[i].stopEvent=function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault?t.preventDefault():t.returnValue=!1},t.Miniscroll=h}(window,document,"prototype");
