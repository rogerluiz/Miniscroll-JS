/**
 * Miniscroll small plugin of scrollbar desktop and mobile
 *
 * @author Roger Luiz <http://rogerluizm.com.br/>
 *					  <http://miniscroll.rogerluizm.com.br>
 *
 * @copyright (c) 2011, 2012 <http://rogerluizm.com.br/>
 * @package Loo UI
 *
 * @version 0.4v 
 *		- last update 26.06.2012
 * 		- adding the cross-browser fix scrollTop and scrollLeft, see getScrollPercentage();
 * 		- adding the button up and down (buttonUp() and buttonDown()) event and animation effect to the scrollTo();
 * 		- bug of the size (height and width)  of the scroll removed
 *			
 */
(function(a,b){function c(c,d){var e=this;this.target=b.getElementById(c);this.args=d||{};this.scrub=null;this.tracker=null;this.scrollbar=null;this.setDefaultArgs();this.createScrollbar();this.dragging=false;this.x=0;this.y=0;this.ty=0;this.tx=0;this.ratio={x:(this.target.scrollWidth-this.target.offsetWidth)/(this.tracker.offsetWidth-this.scrub.offsetWidth),y:(this.target.scrollHeight-this.target.offsetHeight)/(this.tracker.offsetHeight-this.scrub.offsetHeight)};this.point=null;this.speed={x:10,y:10};this.isClicked=false;this.scrollToPos={x:this.scrub.offsetLeft,y:this.scrub.offsetTop};this.scrollTime=null;this.scrollHeight=this.target.scrollHeight;if(this.isTouchDevice()){this.addEvent(this.target,"touchstart",function(a){e.onTouchStart(a)})}else{this.addEvent(this.scrub,"mousedown",function(a){e.stopEvent(a);e.onStartDrag(a)});this.addEvent(this.tracker,"mousedown",function(a){e.stopEvent(a);e.onTrackerMove(a)});this.addEvent(this.target,"mousewheel",function(a){e.stopEvent(a);e.onWheelDrag(a)})}this.scrollTime=a.setInterval(function(){e.onUpdate()},60)}c.prototype.createScrollbar=function(){var a=b.createElement("div");a.setAttribute("id",this.target.id+"_scroll");a.setAttribute("class","miniscrollContainer");if(this.args.axis==="y"){a.style.top=this.target.offsetTop+"px";a.style.left=this.target.offsetLeft+this.target.offsetWidth-this.args.size+"px";a.style.width=this.args.size+"px";a.style.height=this.target.offsetHeight+"px"}else{a.style.top=this.target.offsetTop+this.target.offsetHeight-this.args.size+"px";a.style.left=this.target.offsetLeft+"px";a.style.width=this.target.offsetWidth+"px";a.style.height=this.args.size+"px"}a.style.position="absolute";a.style.zIndex="9999";this.target.appendChild(a);this.scrollbar=b.getElementById(this.target.id+"_scroll");var c=b.createElement("div");c.setAttribute("id",this.target.id+"_tracker");c.setAttribute("class","miniscroll_tracker");if(this.args.axis==="y"){c.style.width=this.args.size+"px";c.style.height=this.target.offsetHeight+"px"}else{c.style.width=this.target.offsetWidth+"px";c.style.height=this.args.size+"px"}if(this.args.trackerColor!==undefined)c.style.backgroundColor=this.args.trackerColor;c.style.position="absolute";a.appendChild(c);this.tracker=b.getElementById(this.target.id+"_tracker");var d=this.target.offsetHeight*c.offsetHeight/this.target.scrollHeight;var e=this.target.offsetWidth*c.offsetWidth/this.target.scrollWidth;var f=b.createElement("div");f.setAttribute("id",this.target.id+"_scrub");f.setAttribute("class","miniscroll_scrub");if(this.args.axis==="y"){f.style.width=this.args.size+"px";if(this.args.handle===undefined||this.args.handle==="auto"){f.style.height=d+"px"}else{f.style.height=this.args.handle+"px"}}else{if(this.args.handle===undefined||this.args.handle==="auto"){f.style.width=e+"px"}else{f.style.width=this.args.handle+"px"}f.style.height=this.args.size+"px"}if(this.args.scrubColor!==undefined)f.style.backgroundColor=this.args.scrubColor;f.style.position="absolute";a.appendChild(f);this.scrub=b.getElementById(this.target.id+"_scrub")};c.prototype.setDefaultArgs=function(){if(this.args.axis===undefined)this.args.axis="y";if(this.args.size===undefined)this.args.size=12;if(this.args.handle===undefined)this.args.handle="auto";if(this.args.scrubColor===undefined)this.args.scrubColor="#000000";if(this.args.trackerColor===undefined)this.args.trackerColor="#ffffff"};c.prototype.onUpdate=function(){var a=this.target.offsetHeight*this.tracker.offsetHeight/this.target.scrollHeight;var b=this.target.offsetWidth*this.tracker.offsetWidth/this.target.scrollWidth;this.ratio={x:(this.target.scrollWidth-this.target.offsetWidth)/(this.tracker.offsetWidth-this.scrub.offsetWidth),y:(this.target.scrollHeight-this.target.offsetHeight)/(this.tracker.offsetHeight-this.scrub.offsetHeight)};if(this.args.axis==="y"){if(this.args.handle===undefined||this.args.handle==="auto"){this.scrub.style.height=a+"px"}if(this.tracker.offsetHeight>=this.target.scrollHeight){this.scrollbar.style.visibility="hidden"}else{this.scrollbar.style.visibility="visible"}this.tracker.style.height=this.target.offsetHeight+"px";if(this.target.scrollHeight>this.scrollHeight){var c=-this.target.scrollTop/(-this.target.scrollHeight+this.target.offsetHeight);this.scroll(0,c*(this.tracker.offsetHeight-this.scrub.offsetHeight))}}else{if(this.args.handle===undefined||this.args.handle==="auto"){this.scrub.style.width=b+"px"}if(this.tracker.offsetWidth>=this.target.scrollWidth){this.scrollbar.style.visibility="hidden"}else{this.scrollbar.style.visibility="visible"}this.tracker.style.width=this.target.offsetWidth+"px";if(this.target.scrollWidth>this.scrollWidth){var c=-this.target.scrollLeft/(-this.target.scrollWidth+this.target.offsetHeight);this.scroll(c*(this.tracker.offsetWidth-this.scrub.offsetWidth),0)}}};c.prototype.onTouchStart=function(a){var b=this;this.ty=a.targetTouches[0].pageY;this.tx=a.targetTouches[0].pageX;this.addEvent(this.target,"touchmove",function(a){b.onTouchMove(event)})};c.prototype.onTouchMove=function(a){a.preventDefault();var b=a.targetTouches[0].pageY;var c=a.targetTouches[0].pageX;this.scroll(this.args.axis==="x"?this.scrub.offsetLeft-(c-this.tx):0,this.args.axis==="y"?this.scrub.offsetTop-(b-this.ty):0);if(this.args.axis==="y")this.ty=b;if(this.args.axis==="x")this.tx=c};c.prototype.onStartDrag=function(c){var c=a.event||c;var d=this;this.dragging=true;this.point={x:c.clientX+this.getScrollPercentage().left-this.findOffset(this.scrub).left,y:c.clientY+this.getScrollPercentage().top-this.findOffset(this.scrub).top,offsetX:this.findOffset(this.tracker).left,offsetY:this.findOffset(this.tracker).top};this.addEvent(b,"mousemove",function(a){d.stopEvent(a);d.onMoveDrag(a)});this.addEvent(b,"mouseup",function(a){d.stopEvent(a);d.onStopDrag(a)})};c.prototype.onMoveDrag=function(b){var b=a.event||b;var c={x:b.clientX+this.getScrollPercentage().left-this.point.offsetX,y:b.clientY+this.getScrollPercentage().top-this.point.offsetY};var d={x:c.x-this.point.x,y:c.y-this.point.y};if(this.dragging){this.scroll(d.x,d.y)}this.stopEvent(b)};c.prototype.onTrackerMove=function(b){var b=a.event||b;var c={x:b.clientX+this.getScrollPercentage().left,y:b.clientY+this.getScrollPercentage().top};var d={x:c.x-this.findOffset(this.tracker).left-this.scrub.offsetWidth/2,y:c.y-this.findOffset(this.tracker).top-this.scrub.offsetHeight/2};this.scroll(d.x,d.y)};c.prototype.onWheelDrag=function(b){var b=a.event||b;var c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail));this.scroll(this.x+ -c*20,this.y+ -c*20)};c.prototype.onStopDrag=function(a){this.dragging=false;this.scrollToPos={x:this.scrub.offsetLeft,y:this.scrub.offsetTop};this.removeEvent(b,"mousemove",function(a){});this.removeEvent(b,"mouseup",function(a){})};c.prototype.scroll=function(a,b){if(this.args.axis==="y"){if(b>this.tracker.offsetHeight-this.scrub.offsetHeight){b=this.tracker.offsetHeight-this.scrub.offsetHeight}if(b<0){b=0}this.scrub.style.top=b+"px";this.y=b}else{if(a>this.tracker.offsetWidth-this.scrub.offsetWidth){a=this.tracker.offsetWidth-this.scrub.offsetWidth}if(a<0){a=0}this.scrub.style.left=a+"px";this.x=a}if(this.isClicked===false){this.speed.x=a;this.speed.y=b}else{this.scrollToPos={x:this.scrub.offsetLeft,y:this.scrub.offsetTop}}this.contentTo()};c.prototype.buttonUp=function(c){var d=this;var c=b.getElementById(c);var e=null;var f=this.tracker.offsetHeight-this.scrub.offsetHeight+this.findOffset(this.target).top;var g=this.tracker.offsetWidth-this.scrub.offsetWidth+this.findOffset(this.target).left;this.addEvent(c,"mousedown",function(){d.isClicked=true;e=a.setInterval(function(){if(d.speed.y<0){d.speed.y=0}if(d.speed.x<0){d.speed.x=0}d.speed.y-=(f+d.speed.y)*.05;d.speed.x-=(g+d.speed.x)*.05;d.scrollTo(d.speed.x,d.speed.y)},30)});this.addEvent(c,"mouseup",function(){d.isClicked=false;clearInterval(e)})};c.prototype.buttonDown=function(c){var d=this;var c=b.getElementById(c);var e=null;var f=this.tracker.offsetHeight-this.scrub.offsetHeight+this.findOffset(this.target).top;var g=this.tracker.offsetWidth-this.scrub.offsetWidth+this.findOffset(this.target).left;this.addEvent(c,"mousedown",function(){d.isClicked=true;e=a.setInterval(function(){if(d.speed.y>f){d.speed.y=f}if(d.speed.x>g){d.speed.x=g}d.speed.y+=(f-d.speed.y)*.05;d.speed.x+=(g-d.speed.x)*.05;d.scrollTo(d.speed.x,d.speed.y)},30)});this.addEvent(c,"mouseup",function(){d.isClicked=false;clearInterval(e)})};c.prototype.scrollTo=function(b,c){var d=this;if(!d.isClicked){var e=a.setInterval(function(){if(Math.round(d.scrollToPos.y)<c){d.scrollToPos.y+=(c-d.scrollToPos.y)*.05;d.scrollToPos.x+=(b-d.scrollToPos.x)*.05}else if(Math.round(d.scrollToPos.y)>c){d.scrollToPos.y-=(c+d.scrollToPos.y)*.05;d.scrollToPos.x-=(b+d.scrollToPos.x)*.05}d.scroll(d.scrollToPos.x/d.ratio.x,d.scrollToPos.y/d.ratio.y);if(d.args.axis==="y"&&Math.round(d.scrollToPos.y)===c){clearInterval(e)}else if(d.args.axis==="x"&&Math.round(d.scrollToPos.x)===b){clearInterval(e)}},30)}else{d.scroll(b/d.ratio.x,c/d.ratio.y)}};c.prototype.contentTo=function(){if(this.args.axis==="y"){this.target.scrollTop=Math.round(this.y*this.ratio.y)}else{this.target.scrollLeft=Math.round(this.x*this.ratio.x)}};c.prototype.getScrollPercentage=function(){var a;var c;if(b.documentElement&&b.documentElement.scrollTop){a=b.documentElement.scrollTop}else{a=b.body.scrollTop}if(b.documentElement&&b.documentElement.scrollLeft){c=b.documentElement.scrollLeft}else{c=b.body.scrollLeft}return{top:a,left:c}};c.prototype.findOffset=function(a){var b=0;if(a.offsetParent){while(a.offsetParent){b+=a.offsetTop;a=a.offsetParent}}var c=0;if(a.offsetParent){while(a.offsetParent){c+=a.offsetLeft;a=a.offsetParent}}return{top:b,left:c}};c.prototype.addEvent=function(a,b,c){if(a.addEventListener){if(b==="mousewheel"){var d=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";a.addEventListener(d,c,false)}else{a.addEventListener(b,c,false)}this.addEvent=function(a,b,c){a.addEventListener(b,c,false)}}else if(a.attachEvent){a.attachEvent("on"+b,c);this.addEvent=function(a,b,c){a.attachEvent("on"+b,c)}}else{a["on"+b]=c;this.addEvent=function(a,b,c){a["on"+b]=c}}};c.prototype.removeEvent=function(a,b,c){if(a.addEventListener){if(b==="mousewheel"){var d=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";a.removeEventListener(d,c,false)}else{a.removeEventListener(b,c,false)}this.removeEvent=function(a,b,c){a.removeEventListener(b,c,false)}}else if(a.attachEvent){a.detachEvent("on"+b,c);this.removeEvent=function(a,b,c){a.detachEvent("on"+b,c)}}else{a["on"+b]=null;this.removeEvent=function(a,b,c){a["on"+b]=null}}};c.prototype.stopEvent=function(a){if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};c.prototype.isTouchDevice=function(){return"ontouchstart"in a};a.Miniscroll=c})(window,document)